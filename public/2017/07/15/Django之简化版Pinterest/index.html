<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Django之简化版Pinterest | i@m</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/normalize.min.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><script type="text/javascript" src="/js/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Django之简化版Pinterest</h1><a id="logo" href="/.">i@m</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Django之简化版Pinterest</h1><div class="post-meta">Jul 15, 2017<span> | </span><span class="category"><a href="/categories/Python/">Python</a></span><script src="/js/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><p>Django是最流行开放源代码的Web应用框架之一，由Python写成，采用了MVC的框架模式。使用 Django，在短时间内就可以创建高品质、易维护的网站。</p>
<h3 id="组件和架构"><a href="#组件和架构" class="headerlink" title="组件和架构"></a>组件和架构</h3><p>Django框架的核心包括：一个映射器，用作数据模型（以Python类的形式定义）和数据库间的媒介；一个基于正则表达式的URL分发器；一个视图系统，用于处理请求；以及一个模板系统。 核心框架中还包括：</p>
<ul>
<li>一个轻量级的、独立的Web服务器，用于开发和测试。</li>
<li>一个表单序列化及验证系统，用于HTML表单和适于数据库存储的数据之间的转换。</li>
<li>一个缓存框架，并有几种缓存方式可供选择。</li>
<li>中间件支持，允许对请求处理的各个阶段进行干涉。</li>
<li>内置的分发系统允许应用程序中的组件采用预定义的信号进行相互间的通信。</li>
<li>一个序列化系统，能够生成或读取采用XML或JSON表示的Django模型实例。</li>
<li>一个用于扩展模板引擎的能力的系统。</li>
</ul>
<p><strong>其架构如下：</strong></p>
<p><img src="https://ask.hellobi.com/uploads/article/20170519/419f42b654768de7612026eb4908838f.png" alt="Clipboard Image.png"></p>
<p><strong>Django的请求处理流程</strong></p>
<ol>
<li>用户在浏览器中输入一个网站的URL；</li>
<li>请求经Django处理后通过url映射关系(URLConf)找到对应的视图(View)；</li>
<li>视图(View)中负责具体业务的处理；</li>
<li>在处理过程中，通过模型(Model)这种对象关系映射(Object Relational Mapping，简称ORM)对数据数据进行读写；</li>
<li>模型(Model)处理底层处理数据后返回给视图(View);</li>
<li>视图(View)将数据渲染到对应的模板（Templates)生成网页返回给浏览器;</li>
<li>Django还内置了一个缓存框架，当相同的请求过来时会优先从缓存中读取结果直接返回。</li>
</ol>
<p>上述流程只是简单的描述了大概过程，实际上还有很多中间件(Middleware)会对请求进行处理。下面开始实现Django的实例。</p>
<p>Pinterest是最近流行的一个图片分享网站，它使用Django进行开发。这里用Django实现一个简化版的Pinterest网站。效果如下：</p>
<p><img src="http://101python.cn/static/images/mini_pinterest_prettify.gif" alt="img"></p>
<h3 id="创建网站"><a href="#创建网站" class="headerlink" title="创建网站"></a>创建网站</h3><p><strong>1.安装Django</strong></p>
<p>先新建一个django_tutorial的文件夹，并切换至该目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ mkdir django_tutorial</div><div class="line">$ cd django_tutorial</div></pre></td></tr></table></figure>
<p>安装Django</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pip install django</div></pre></td></tr></table></figure>
<p><strong>2.初始化mini_pinterest项目</strong></p>
<p>建立mini_pinterest项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">django-admin.py startproject mini_pinterest</div></pre></td></tr></table></figure>
<p>创建后目录结构和说明如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mini_pinterest</div><div class="line">    ├── manage.py       - 用于管理Django站点</div><div class="line">    └── mini_pinterest</div><div class="line">        ├── __init__.py - Python模块标识</div><div class="line">        ├── settings.py - 项目配置文件</div><div class="line">        ├── urls.py     - URL配置文件</div><div class="line">        └── wsgi.py     - 内置runserver命令的WSGI应用配置</div></pre></td></tr></table></figure>
<p><strong>3.创建Pinterest应用</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ python manage.py startapp pinterest</div></pre></td></tr></table></figure>
<p>执行完成后会自动生成一个同名的文件夹，目录结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">mini_pinterest</div><div class="line">├── manage.py</div><div class="line">├── mini_pinterest</div><div class="line">│   ├── __init__.py</div><div class="line">│   ├── settings.py</div><div class="line">│   ├── urls.py</div><div class="line">│   └── wsgi.py</div><div class="line">└── pinterest</div><div class="line">    ├── __init__.py</div><div class="line">    ├── admin.py</div><div class="line">    ├── apps.py</div><div class="line">    ├── migrations</div><div class="line">    │   └── __init__.py</div><div class="line">    ├── models.py</div><div class="line">    ├── tests.py</div><div class="line">    └── views.py</div></pre></td></tr></table></figure>
<p>此时Django还不能调用此应用，要想使用这个应用，需要把它加到Django的配置文件中。即把应用的名字pinterest加到Django的settings.py文件中的INSTALLED_APPS变量中，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"># mini_pinterest/settings.py</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"># Application definition</div><div class="line"></div><div class="line">INSTALLED_APPS = [</div><div class="line">    &apos;django.contrib.admin&apos;,</div><div class="line">    &apos;django.contrib.auth&apos;,</div><div class="line">    &apos;django.contrib.contenttypes&apos;,</div><div class="line">    &apos;django.contrib.sessions&apos;,</div><div class="line">    &apos;django.contrib.messages&apos;,</div><div class="line">    &apos;django.contrib.staticfiles&apos;,</div><div class="line">    # 添加pinterest应用</div><div class="line">    &apos;pinterest&apos;,</div><div class="line">]</div><div class="line"></div><div class="line">...</div></pre></td></tr></table></figure>
<p>先初始化数据库，执行以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">$ python manage.py migrate</div><div class="line">Operations to perform:</div><div class="line">  Apply all migrations: admin, auth, contenttypes, sessions</div><div class="line">Running migrations:</div><div class="line">  Applying contenttypes.0001_initial... OK</div><div class="line">  Applying auth.0001_initial... OK</div><div class="line">  Applying admin.0001_initial... OK</div><div class="line">  Applying admin.0002_logentry_remove_auto_add... OK</div><div class="line">  Applying contenttypes.0002_remove_content_type_name... OK</div><div class="line">  Applying auth.0002_alter_permission_name_max_length... OK</div><div class="line">  Applying auth.0003_alter_user_email_max_length... OK</div><div class="line">  Applying auth.0004_alter_user_username_opts... OK</div><div class="line">  Applying auth.0005_alter_user_last_login_null... OK</div><div class="line">  Applying auth.0006_require_contenttypes_0002... OK</div><div class="line">  Applying auth.0007_alter_validators_add_error_messages... OK</div><div class="line">  Applying auth.0008_alter_user_username_max_length... OK</div><div class="line">  Applying sessions.0001_initial... OK</div></pre></td></tr></table></figure>
<p><strong>4.创建数据模型结构</strong></p>
<p>Django默认使用Sqlite数据库。SQLite，是一款轻型的数据库，以单个文件的形式存在，简单方便无需安装。这里不用做修改。它在Django的配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># mini_pinterest/settings.py</div><div class="line"></div><div class="line">...</div><div class="line"># Database</div><div class="line"># https://docs.djangoproject.com/en/1.11/ref/settings/#databases</div><div class="line"></div><div class="line">DATABASES = &#123;</div><div class="line">    &apos;default&apos;: &#123;</div><div class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.sqlite3&apos;,        - 使用的数据库引擎</div><div class="line">        &apos;NAME&apos;: os.path.join(BASE_DIR, &apos;db.sqlite3&apos;),  - 数据库名字</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">...</div></pre></td></tr></table></figure>
<p><strong>创建模型</strong></p>
<p>在pinterest/models.py文件中建立一个Image模型，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># pinterest/models.py</div><div class="line"></div><div class="line">from django.db import models</div><div class="line"></div><div class="line"></div><div class="line">class Image(models.Model):</div><div class="line">    img = models.ImageField(upload_to=&apos;upload&apos;)    # 图片文件,上传至img文件夹</div><div class="line">    description = models.TextField()            # 图片描述, 长文本类型</div><div class="line">    created = models.DateTimeField(auto_now_add=True)  # 创建时间,自动添加当前时间</div></pre></td></tr></table></figure>
<p><strong>建立数据表</strong></p>
<p>为了创建模型对应的数据表，需要先生成对应的数据迁移脚步(migrations)，执行命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ python manage.py makemigrations</div><div class="line">Migrations for &apos;pinterest&apos;:</div><div class="line">  pinterest/migrations/0001_initial.py</div><div class="line">    - Create model Image</div></pre></td></tr></table></figure>
<p>数据迁移脚步生成后，就可以开始建立数据表，执行命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ python manage.py migrate</div><div class="line">Operations to perform:</div><div class="line">  Apply all migrations: admin, auth, contenttypes, pinterest, sessions</div><div class="line">Running migrations:</div><div class="line">  Applying pinterest.0001_initial... OK</div></pre></td></tr></table></figure>
<p><strong>5.创建管理后台</strong></p>
<p>Django默认已经内置了一个管理后台，要使用它需要先创建一个超级用户(superuser)。执行如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ python manage.py createsuperuser</div><div class="line">Username (leave blank to use &apos;guoyuxia&apos;): demo</div><div class="line">Email address:</div><div class="line">Password:</div><div class="line">Password (again):</div><div class="line">Superuser created successfully.</div></pre></td></tr></table></figure>
<p>这样一个超级用户就创建成功了。</p>
<p><strong>注册模型</strong></p>
<p>为了将模型添加到管理后台，需要将模型注册到管理后台，在admin.py文件中添加相应的模型。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># pinterest/models.py</div><div class="line"></div><div class="line">from django.contrib import admin</div><div class="line">from .models import Image</div><div class="line"></div><div class="line">admin.site.register(Image)</div></pre></td></tr></table></figure>
<p>至此，就可以使用管理后台来管理模型了。进入项目目录，在终端中执行以下命令启动网站：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ python manage.py runserver</div><div class="line">Performing system checks...</div><div class="line"></div><div class="line">System check identified no issues (0 silenced).</div><div class="line">May 08, 2017 - 15:29:11</div><div class="line">Django version 1.11.1, using settings &apos;mini_pinterest.settings&apos;</div><div class="line">Starting development server at http://127.0.0.1:8000/</div><div class="line">Quit the server with CONTROL-C.</div></pre></td></tr></table></figure>
<p>在浏览器中输入<a href="http://127.0.0.1:8000/admin" target="_blank" rel="external">http://127.0.0.1:8000/admin</a> 进行访问，效果如下：</p>
<p><img src="http://101python.cn/static/images/django_admin.gif" alt="img"></p>
<p><strong>6.实现展示页面</strong></p>
<p>完成上述代码后已经可以进行图片的增删改查功能，接下来就是实现最后的展示页面。这里需要做的是在Django中建立一个视图(view)和模板(template)。</p>
<p><strong>建立视图</strong></p>
<p>视图其实就是一个特殊的函数，用来处理网络请求并返回结果。它以请求对象(request)为参数，返回一个HttpResponse对象。在pinterest下的views.py创建一个名为index的函数。index函数中获取所有的图片对象，然后将这些图片数据渲染到一个模板中。函数代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"># pinterest/views.py</div><div class="line"></div><div class="line">from django.shortcuts import render</div><div class="line"># 导入图片模型</div><div class="line">from .models import Image</div><div class="line"></div><div class="line"></div><div class="line">def index(request):</div><div class="line">    # 获取图片列表</div><div class="line">    image_list = Image.objects.all()</div><div class="line">    # 将image_list传入模板进行数据渲染, 然后返回给浏览器</div><div class="line">    return render(request, &apos;index.html&apos;, &#123;&apos;image_list&apos;: image_list&#125;)</div></pre></td></tr></table></figure>
<p><strong>配置URL</strong></p>
<p>视图函数创建完成后还需要进行URL配置，这样Django才能知道一个请求地址过来该执行哪个视图函数。配置是通过urls.py文件中urlpatterns加入一个url函数，该函数接受两个参数(一个URL正则表达式和一个视图函数）。代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"># mini_pinterest</div><div class="line"></div><div class="line">from django.conf.urls import url</div><div class="line">from django.contrib import admin</div><div class="line"># 导入视图</div><div class="line">from pinterest import views</div><div class="line"></div><div class="line">urlpatterns = [</div><div class="line">    url(r&apos;^admin/&apos;, admin.site.urls),</div><div class="line">    # 添加URL, 这里^$表示首页的请求交给views下的index函数处理</div><div class="line">    url(r&apos;^$&apos;, views.index),</div><div class="line">]</div></pre></td></tr></table></figure>
<p><strong>创建模板</strong></p>
<p>现在URL已经配置OK，对应的视图函数也已完成，最后就剩下渲染需要的模板。所有的模板一个会放在一个名叫templates的文件夹下以方便管理。在mini_pinterest文件夹下创建一个名叫tempates的文件夹。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ mkdir templates</div><div class="line">$ ls</div><div class="line">db.sqlite3     manage.py      pinterest</div><div class="line">img            mini_pinterest templates</div></pre></td></tr></table></figure>
<p>文件夹创建成功后，需要在Django配置文件(settings.py)中TEMPLATES变量中加一个模板文件夹的路径告诉Django模板文件去哪里查找。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">TEMPLATES = [</div><div class="line">    &#123;</div><div class="line">        &apos;BACKEND&apos;: &apos;django.template.backends.django.DjangoTemplates&apos;,</div><div class="line">        # 这里添加templates文件夹的路径</div><div class="line">        # BASE_DIR表示mini_pinterest文件夹的全路径</div><div class="line">        # os.path.join(BASE_DIR, &apos;templates&apos;)表示mini_pinterest文件夹下的templates文件夹</div><div class="line">        &apos;DIRS&apos;: [os.path.join(BASE_DIR, &apos;templates&apos;)],</div><div class="line">        &apos;APP_DIRS&apos;: True,</div><div class="line">        &apos;OPTIONS&apos;: &#123;</div><div class="line">            &apos;context_processors&apos;: [</div><div class="line">                &apos;django.template.context_processors.debug&apos;,</div><div class="line">                &apos;django.template.context_processors.request&apos;,</div><div class="line">                &apos;django.contrib.auth.context_processors.auth&apos;,</div><div class="line">                &apos;django.contrib.messages.context_processors.messages&apos;,</div><div class="line">            ],</div><div class="line">        &#125;,</div><div class="line">    &#125;,</div><div class="line">]</div><div class="line"></div><div class="line">...</div></pre></td></tr></table></figure>
<p>这样Django在视图函数中渲染模板的时候就会自动从该templates文件夹下自动查找对应名字的模板文件。接下是来需要做的就在templates目录下新建一个名为index.html的文件。</p>
<p>这个模板本质上可以说是一个html文件，在其中加入了一下Django的变量和标签。其中变量就是视图中传入模板的数据，可以动态的生成不同的内容。标签类似于Python的语法，Django有许多内置的标签，可以让模板中支持逻辑判断、循环、格式化等功能。这里在index.html文件中循环显示管理后台的所有图片，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html lang=&quot;en&quot;&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</div><div class="line">    &lt;title&gt;Mini Pinterest&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;!--循环图片列表--&gt;</div><div class="line"></div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p><strong>查看效果</strong></p>
<p>模板完成后让我们来看下效果，在浏览器中输入<a href="http://127.0.0.1:5000/" target="_blank" rel="external">http://127.0.0.1:5000/</a> 进行访问，发现显示结果如下：</p>
<p><img src="http://101python.cn/static/images/django_error.png" alt="img"></p>
<p>Oops,咋回事？描述显示出来了，但是图片却都没有显示。检查下终端中的访问记录：</p>
<p><img src="http://101python.cn/static/images/django_log.png" alt="img"></p>
<p>可以发现，访问日志中都返回了404(资源未找到)。难道是图片上传失败了？！！ 进入项目文件夹，用命令看下当前文件夹中内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">│   └── index.html</div><div class="line">└── upload</div><div class="line">    ├── 0e272102376f4e2d4b5a8a4e763ddf74.jpg</div><div class="line">    ├── 3f1d601a47c081f358f3f51fc11d2a37.jpg</div><div class="line">    ├── 64d9c7134f3540862726bacd87a0c477.jpg</div><div class="line">    ├── 9cdd6f1ecd73e909a6a719cd0ad65272.jpg</div><div class="line">    ├── apic14052.jpg</div><div class="line">    ├── e2f36311b9eed0badea5f94b87d8bf70.jpg</div><div class="line">    ├── e77338edefa4d47aacf8da4a4c401239.jpg</div><div class="line">    ├── f7313b3bd990888565d7ffa56f81eb6e.jpg</div><div class="line">    ├── frog-2240764_1920.jpg</div><div class="line">    ├── wallpaper.png</div><div class="line">    └── xpic6813.jpg</div></pre></td></tr></table></figure>
<p>可以看到图片都已经上传到指定的upload文件夹中了。分析到这里，基本可以确定是Django中没有配置正确的URL解析路径导致无法定位upload文件夹的图片。解决方法是在urls.py中配置一个url地址。首先在settings.py最后配置图片的本地路径和请求地址路径：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># mini_pinterest/settings.py</div><div class="line">...</div><div class="line"># 加入图片本地路径和范围路径</div><div class="line">MEDIA_ROOT = BASE_DIR # BASE_DIR 表示当前文件夹</div><div class="line">MEDIA_URL = &apos;/upload/&apos;</div></pre></td></tr></table></figure>
<p>然后在urls.py文件中加入相应的url解析路径。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># mini_pinterest/urls.py</div><div class="line"></div><div class="line">...</div><div class="line">from django.conf import settings</div><div class="line"># 导入static函数</div><div class="line">from django.conf.urls.static import static</div><div class="line">...</div><div class="line"></div><div class="line"># 加入图片url</div><div class="line">urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)</div></pre></td></tr></table></figure>
<p>在浏览器中重新访问<a href="http://127.0.0.1:5000/%E5%8F%91%E7%8E%B0%E5%8F%AF%E4%BB%A5%E6%AD%A3%E5%B8%B8%E6%98%BE%E7%A4%BA%E4%BA%86%EF%BC%8C%E6%95%88%E6%9E%9C%E5%A6%82%E4%B8%8B" target="_blank" rel="external">http://127.0.0.1:5000/发现可以正常显示了，效果如下</a>:</p>
<p><img src="http://101python.cn/static/images/mini_pinterest.gif" alt="img"></p>
<p>图片是正常显示了，但界面未免太简陋了。作为一个有追求的码农，必须要优化下展示效果。However，我不太擅长前端页面展示T_T.</p>
<p><img src="http://101python.cn/static/images/cry.jpg" alt="img"></p>
<p>不慌，在免费开源漫天飞的互联网时代，想找个好看的模板想必也不是件难事。具体细节就不唠叨了，经过几分钟的Google，找到了一个比较满意的模板。将模板中的css和js文件加入到mini_pinterest文件中,最后的展示效果如下：</p>
<p><img src="http://101python.cn/static/images/mini_pinterest_prettify.gif" alt="img"></p>
<p>OK, 收工！</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://mpengju.com/2017/07/15/Django之简化版Pinterest/" data-id="cj6j0quwy00164w633yw7abjv" class="article-share-link">分享</a><div class="tags"><a href="/tags/Python/">Python</a><a href="/tags/服务器/">服务器</a></div><div class="post-nav"><a href="/2017/07/15/Django入门/" class="pre">Django入门</a><a href="/2017/07/15/Arduino超声测距离传感器/" class="next">Arduino超声测距离传感器</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://mpengju.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Arduino/">Arduino</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tomcat/">Tomcat</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/fedora/">fedora</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/github/">github</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/html/">html</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nodejs/">nodejs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/raspberry-pi/">raspberry pi</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/react/">react</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/实验/">实验</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/树莓派/">树莓派</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/正则/">正则</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/移动端/">移动端</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/远程登录/" style="font-size: 15px;">远程登录</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/webview/" style="font-size: 15px;">webview</a> <a href="/tags/h5/" style="font-size: 15px;">h5</a> <a href="/tags/Arduino/" style="font-size: 15px;">Arduino</a> <a href="/tags/控制器/" style="font-size: 15px;">控制器</a> <a href="/tags/舵机/" style="font-size: 15px;">舵机</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/服务器/" style="font-size: 15px;">服务器</a> <a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/fedora/" style="font-size: 15px;">fedora</a> <a href="/tags/SSH/" style="font-size: 15px;">SSH</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/Flask/" style="font-size: 15px;">Flask</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/tags/html/" style="font-size: 15px;">html</a> <a href="/tags/mongodb/" style="font-size: 15px;">mongodb</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/代码块/" style="font-size: 15px;">代码块</a> <a href="/tags/SASS/" style="font-size: 15px;">SASS</a> <a href="/tags/ajax/" style="font-size: 15px;">ajax</a> <a href="/tags/Tomcat/" style="font-size: 15px;">Tomcat</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/上传/" style="font-size: 15px;">上传</a> <a href="/tags/转换/" style="font-size: 15px;">转换</a> <a href="/tags/树莓派/" style="font-size: 15px;">树莓派</a> <a href="/tags/物联网/" style="font-size: 15px;">物联网</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/vlc/" style="font-size: 15px;">vlc</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/清理垃圾/" style="font-size: 15px;">清理垃圾</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/域名/" style="font-size: 15px;">域名</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/主题/" style="font-size: 15px;">主题</a> <a href="/tags/存储/" style="font-size: 15px;">存储</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/命令/" style="font-size: 15px;">命令</a> <a href="/tags/less/" style="font-size: 15px;">less</a> <a href="/tags/格式化/" style="font-size: 15px;">格式化</a> <a href="/tags/jquery/" style="font-size: 15px;">jquery</a> <a href="/tags/npm/" style="font-size: 15px;">npm</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/卸载/" style="font-size: 15px;">卸载</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/邮件/" style="font-size: 15px;">邮件</a> <a href="/tags/react/" style="font-size: 15px;">react</a> <a href="/tags/直流电机/" style="font-size: 15px;">直流电机</a> <a href="/tags/语音聊天/" style="font-size: 15px;">语音聊天</a> <a href="/tags/移动端/" style="font-size: 15px;">移动端</a> <a href="/tags/WEB/" style="font-size: 15px;">WEB</a> <a href="/tags/兼容性/" style="font-size: 15px;">兼容性</a> <a href="/tags/显示器/" style="font-size: 15px;">显示器</a> <a href="/tags/正则/" style="font-size: 15px;">正则</a> <a href="/tags/人脸识别/" style="font-size: 15px;">人脸识别</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/08/19/jquery.validate.js使用教程/">jquery.validate.js使用教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/18/js操作COOKIE/">js操作COOKIE</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/05/ArduinoPS2游戏摇杆/">Arduino简单实例之四_PS2游戏摇杆</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/03/Arduino控制MG995/">Arduino控制MG995</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/01/树莓派使用Nokia5110显示屏显示系统信息/">树莓派使用Nokia5110显示屏显示系统信息</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/25/树莓派Scratch入门教程——最简单的方式制作智能小车GPIO篇/">树莓派Scratch入门教程——最简单的方式制作智能小车GPIO篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/25/常用js代码/">常用js代码</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/25/HTML5创建indexedDB数据库并使用/">HTML5创建indexedDB数据库并使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/21/使pre的内容自动换行/">使pre的内容自动换行</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/15/长按删除/">长按删除</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://mpengju.com" title="i@m" target="_blank">i@m</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">i@m.</a> Powered by<a rel="nofollow" target="_blank"> Hexo.</a><a rel="nofollow" target="_blank"> Theme</a> by<a rel="nofollow" target="_blank" href="mailto:i@mpengju.com?subject=我是？&amp;body=很高兴认识你"> i@mpengju.com</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>